= Email Address Management

== Updating
[cols="1,3a", stripes="even"]
|===
| Endpoint
| https://api.gocarrot.com/v2/email
| Request Type
| POST
| Content-Type
| application/json or application/x-www-form-urlencoded
| Rate Limiting
| 300 requests per second
|===

Description: The `v2/email` endpoint allows for server side modification of player email addresses. For example, this API can be connected to your internal administrative tools to ensure that the email address Teak has on file for a player is promptly updated in response to any modifications made in your internal administrative tools.

Please be aware that Teak enforces that each player may only have a single email address, and each email address may only belong to a single player. The response to this API will inform you of the actions Teak took in order to preserve these invariants while making the requested change.

=== Required Parameters
[cols="1,3a", stripes="even"]
|===
| game_id
| Your Teak App ID
| secret_key
| Your Teak Server Secret
| user_id
| The Game Assigned Player ID of the player you are updating the email address for. This must match the value provided by the game client's Teak SDK integration.
| email
| The email address to assign to this player.
|===

=== Success Response

:response-code: 200
:response-body: JSON dictionary with 'status' and 'action' keys. 'status' will be 'ok'. 'action' will be one of 'moved_and_changed', 'moved', 'changed', 'added', or 'none', depending on the action taken to update the email address for the player.
:response-example: {"status": "ok", "action": "added"}
include::partial$response.adoc[]

=== Email Changed Success Response

:response-code: 200
:response-body: JSON dictionary with 'status', 'action', and 'previous_email' keys. 'action' will be 'changed', and 'previous_email' will be the email address previously on file for the user before this API call.
:response-example: {"status":"ok", "action":"changed", "previous_email":"foo@example.com"}
include::partial$response.adoc[]

=== Email Moved Success Response

:response-code: 200
:response-body: JSON dictionary with 'status', 'action', and 'previous_player_ids' keys. 'action' will be 'moved', and 'previous_player_ids' will be an array of strings of all the game assigned player ids Teak has associated with the internal player record that previously had the given email address.
:response-example: {"status":"ok", "action":"moved", "previous_player_ids":["abc", "def"]}
include::partial$response.adoc[]

=== Email Moved And Changed Success Response

:response-code: 200
:response-body: JSON dictionary with 'status', 'action', 'previous_email', and 'previous_player_ids' keys. 'action' will be 'moved_and_changed', 'previous_email' will be the email address previously on file for the user before this API call, and 'previous_player_ids' will be an array of strings of all the game assigned player ids Teak has associated with the internal player record that previously had the given email address.
:response-example: {"status":"ok", "action":"moved_and_changed", "previous_email":"foo@example.com", "previous_player_ids":["abc", "def"]}
include::partial$response.adoc[]

=== Error Responses

==== Not Found

:response-code: 404
:response-body: JSON dictionary with 'status' and 'errors' keys. 'status' will be 'error'. 'errors' will be a dictionary containing keys indicating which resources were not found, with values being an array of human readable error messages.
:response-example: {"status":"error","errors":{"user_id":["No player with id foo"]}}
include::partial$response.adoc[]

==== Rate Limit Response

:response-code: 429
:response-body: JSON dictionary with 'status' and 'errors' keys. 'status' will be 'rate_limit'. 'errors' will contain the key 'rate_limit'
:response-example: {"status":"rate_limit","errors":{"rate_limit":["/v2/email may only be called 300 times per second. Please wait a second and try again"]}}
include::partial$response.adoc[]

== Removing
[cols="1,3a", stripes="even"]
|===
| Endpoint
| https://api.gocarrot.com/v2/email
| Request Type
| DELETE
| Content-Type
| application/json or application/x-www-form-urlencoded
| Rate Limiting
| 300 requests per second
|===

Description: The DELETE `v2/email` endpoint allows for removal of an email address from a player record in Teak.

=== Required Parameters
[cols="1,3a", stripes="even"]
|===
| game_id
| Your Teak App ID
| secret_key
| Your Teak Server Secret
| user_id
| The Game Assigned Player ID of the player you are updating the email address for. This must match the value provided by the game client's Teak SDK integration.
|===

=== Email Removed Success Response

:response-code: 200
:response-body: JSON dictionary with 'status' and 'action' keys. 'status' will be 'ok' and 'action' will be 'removed'.
:response-example: {"status":"ok", "action":"removed"}
include::partial$response.adoc[]

=== Email Already Absent Success Response

:response-code: 200
:response-body: JSON dictionary with 'status' and 'action' keys. 'status' will be 'ok' and 'action' will be 'none'.
:response-example: {"status":"ok", "action":"none"}
include::partial$response.adoc[]

=== Error Responses

==== Not Found

:response-code: 404
:response-body: JSON dictionary with 'status' and 'errors' keys. 'status' will be 'error'. 'errors' will be a dictionary containing keys indicating which resources were not found, with values being an array of human readable error messages.
:response-example: {"status":"error","errors":{"user_id":["No player with id foo"]}}
include::partial$response.adoc[]

==== Rate Limit Response

:response-code: 429
:response-body: JSON dictionary with 'status' and 'errors' keys. 'status' will be 'rate_limit'. 'errors' will contain the key 'rate_limit'
:response-example: {"status":"rate_limit","errors":{"rate_limit":["/v2/email may only be called 300 times per second. Please wait a second and try again"]}}
include::partial$response.adoc[]
